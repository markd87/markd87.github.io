<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" /><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Stocks | Mark Danovich</title>
<meta name="generator" content="Jekyll v4.0.1" />
<meta property="og:title" content="Stocks" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The stock market is known to be a highly complex and unpredictable dynamic system, driven by multiple inputs on multiple time scales. It has even been theorised (Efficient Market Hypothesis) that one cannot beat the stock market, as it is highly efficient and always reflects all existing information in the market." />
<meta property="og:description" content="The stock market is known to be a highly complex and unpredictable dynamic system, driven by multiple inputs on multiple time scales. It has even been theorised (Efficient Market Hypothesis) that one cannot beat the stock market, as it is highly efficient and always reflects all existing information in the market." />
<meta property="og:site_name" content="Mark Danovich" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-10-13T17:50:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Stocks" />
<script type="application/ld+json">
{"description":"The stock market is known to be a highly complex and unpredictable dynamic system, driven by multiple inputs on multiple time scales. It has even been theorised (Efficient Market Hypothesis) that one cannot beat the stock market, as it is highly efficient and always reflects all existing information in the market.","@type":"BlogPosting","headline":"Stocks","dateModified":"2020-10-13T17:50:00-05:00","datePublished":"2020-10-13T17:50:00-05:00","url":"/2020/10/13/stocks.html","mainEntityOfPage":{"@type":"WebPage","@id":"/2020/10/13/stocks.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css" /><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Mark Danovich" /><script async src="https://www.googletagmanager.com/gtag/js?id=UA-10819841-6"></script>
<script>
  window['ga-disable-UA-10819841-6'] = window.doNotTrack === "1" || navigator.doNotTrack === "1" || navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1";
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-10819841-6');
</script>
 




 
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"
    integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"
    integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz"
    crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"
    integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI"
    crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        renderMathInElement(document.body, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "[%", right: "%]", display: true },
                { left: "$", right: "$", display: false }
            ]
        }
        );
    });
</script>


<script>
    function wrap_img(fn) {
        if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
            var elements = document.querySelectorAll(".post img");
            Array.prototype.forEach.call(elements, function (el, i) {
                if (el.getAttribute("title")) {
                    const caption = document.createElement('figcaption');
                    var node = document.createTextNode(el.getAttribute("title"));
                    caption.appendChild(node);
                    const wrapper = document.createElement('figure');
                    wrapper.className = 'image';
                    el.parentNode.insertBefore(wrapper, el);
                    el.parentNode.removeChild(el);
                    wrapper.appendChild(el);
                    wrapper.appendChild(caption);
                }
            });
        } else { document.addEventListener('DOMContentLoaded', fn); }
    }
    window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // add link icon to anchor tags
        var elem = document.querySelectorAll(".anchor-link")
        elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script></head>
<body><header class="site-header">

    <div class="wrapper"><a class="site-title" rel="author" href="/">Mark Danovich</a><nav class="site-nav">
            <input type="checkbox" id="nav-trigger" class="nav-trigger" />
            <label for="nav-trigger">
                <span class="menu-icon">
                    <svg viewBox="0 0 18 15" width="18px" height="15px">
                        <path
                            d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z" />
                    </svg>
                </span>
            </label>

            <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/snippets.html">Snippets</a></div>
        </nav></div>
</header><main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

    <header class="post-header">
        <h1 class="post-title p-name" itemprop="name headline">Stocks</h1><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-10-13T17:50:00-05:00" itemprop="datePublished">
                Oct 13, 2020
            </time>
        </p><p>
            
            
            <a class="category-tags-link" href="/tag/thoughts">
                thoughts
            </a>
            |
            
            
            <a class="category-tags-link" href="/tag/code">
                code
            </a>
            
            
        </p>

        

        </header>

    <div class="post-content e-content" itemprop="articleBody">
        <p>The stock market is known to be a highly complex and unpredictable dynamic system, driven by multiple inputs on multiple time scales.
It has even been theorised (Efficient Market Hypothesis) that one cannot beat the stock market, as it is highly efficient and always reflects all existing information in the market.</p>

<p>At the end of the day the stock market is a kind of an auction where people sell shares to people willing to buy shares in a given company, creating a balance which is reflected in the current share price of the company.
It is in general thought that the stock market reflects the overall economy as when the economy is growing people will have money to invest creating a bull market, whereas when the economy is in decline people will sell creating a bear market.</p>

<p>The economy as a whole is really composed of multiple somewhat independent parts as reflected in the past year, where an event such as a pandemic although at first hitting everyone at once causing a big collapse around March, quickly saw the stock prices of particularly the tech company rising sharply to rates even higher than those before the pandemic.</p>

<p>Overall investing in stocks especially these days is a good investment for significant returns as compared to any saving accounts or risk-free investments.
Especially taken inflation into account, free-standing money actually loses value, it is therefore a wise decision to have it invested somewhere, and as long as its not all of ones earnings (as there is always risk) it can pay off.</p>

<p>For a casual investor like my self, who’s started only recently (Around August) to invest some money, the relevant time scales range from days through weeks and months to years. I am not interested be constantly checking the stock values at an hourly or sub-hourly frequency. I see it more as a mid to long-range investment believing in the overall trend of particular markets.</p>

<p>People have come up with various indicators to guide the investor on when might be a good time to buy or sell, which I’ve used below. There is no forecasting involved and no price predictions, these are simply indicators of market movement, which in some cases may seem quite arbitrary, but the idea is that by combining a number of these indicators a useful signal may come through with potential for profit. Although individual agents within the market are highly unpredictable, overall there are some patterns or behaviours of the market as a whole which are recurring and have been demonstrated to be good to take note of.</p>

<h2 id="bollinger-bands">Bollinger Bands</h2>

<p>The Bollinger bands represents two bands above and below the close price of a stock. The bands are obtained as $n$ standard deviations of the moving average of the closing price with window $w$ above and below the moving average.</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="normal">b</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">d</mi><mi mathvariant="normal">s</mi></mrow><mo>=</mo><msub><mrow><mi mathvariant="normal">S</mi><mi mathvariant="normal">M</mi><mi mathvariant="normal">A</mi></mrow><mi>w</mi></msub><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">e</mi></mrow><mo stretchy="false">)</mo><mo>±</mo><mi>n</mi><mi>σ</mi><mo stretchy="false">(</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">e</mi></mrow><mo stretchy="false">)</mo><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">{\rm bands} = {\rm SMA}_w({\rm close}) \pm n  \sigma({\rm close}),</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">b</span><span class="mord mathrm">a</span><span class="mord mathrm">n</span><span class="mord mathrm">d</span><span class="mord mathrm">s</span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathrm">S</span><span class="mord mathrm">M</span><span class="mord mathrm">A</span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">c</span><span class="mord mathrm">l</span><span class="mord mathrm">o</span><span class="mord mathrm">s</span><span class="mord mathrm">e</span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">±</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.03588em;">σ</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">c</span><span class="mord mathrm">l</span><span class="mord mathrm">o</span><span class="mord mathrm">s</span><span class="mord mathrm">e</span></span></span><span class="mclose">)</span><span class="mpunct">,</span></span></span></span></span>

<p>where $SMA_w$ is the simple moving average with period $w$ and $\sigma$ is the standard deviation. <code class="highlighter-rouge">close</code> is the time series of the stock closing price.
Typical values are $w=20, n=2$.</p>

<p>The idea is that these two bands represent bounds within which the stock is trading and when the stock reaches the top band it is a sign that the stock is being over bought and is likely that a down trend will start, and vice versa for the lower band.</p>

<h2 id="relative-strength-index-rsi">Relative Strength Index (RSI)</h2>

<p>The RSI is a value between 0 to 100 which is obtained from the ratio of the exponentially moving averages of the gains and loses in a given period. Where a gain or loss is the difference between consecutive closing prices, gain if positive, loss if negative, however the absolute value is used. The ratio is finally scaled between 0 and 100.
The RSI values of 30 and 70 are considered the bounds which indicate over bought and over sold stocks and at which point a momentum shift is anticipated.</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="normal">R</mi><mi mathvariant="normal">S</mi><mi mathvariant="normal">I</mi></mrow><mo>=</mo><mn>100</mn><mrow><mo fence="true">(</mo><mn>1</mn><mo>−</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><mfrac><mrow><mrow><mi mathvariant="normal">E</mi><mi mathvariant="normal">M</mi><mi mathvariant="normal">A</mi></mrow><mo stretchy="false">(</mo><mi>N</mi><mo separator="true">,</mo><mtext> </mtext><mrow><mi mathvariant="normal">g</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi></mrow><mo stretchy="false">)</mo></mrow><mrow><mrow><mi mathvariant="normal">E</mi><mi mathvariant="normal">M</mi><mi mathvariant="normal">A</mi></mrow><mo stretchy="false">(</mo><mi>N</mi><mo separator="true">,</mo><mtext> </mtext><mrow><mi mathvariant="normal">l</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">s</mi></mrow><mo stretchy="false">)</mo></mrow></mfrac></mrow></mfrac><mo fence="true">)</mo></mrow><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">{\rm RSI} = 100\left(1- \frac{1}{1 + \frac{ {\rm EMA}(N,\ {\rm gains})}{ {\rm EMA}(N,\ {\rm losses})}}\right),</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">R</span><span class="mord mathrm">S</span><span class="mord mathrm">I</span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.60004em;vertical-align:-1.55002em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05002em;"><span style="top:-2.2500000000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎝</span></span></span><span style="top:-2.8100000000000005em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-4.05002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎛</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55002em;"><span></span></span></span></span></span></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.11em;"><span class="pstrut" style="height:3.01em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">E</span><span class="mord mathrm mtight">M</span><span class="mord mathrm mtight">A</span></span></span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span><span class="mpunct mtight">,</span><span class="mspace mtight"><span class="mtight"> </span></span><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">l</span><span class="mord mathrm mtight">o</span><span class="mord mathrm mtight">s</span><span class="mord mathrm mtight">s</span><span class="mord mathrm mtight">e</span><span class="mord mathrm mtight">s</span></span></span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">E</span><span class="mord mathrm mtight">M</span><span class="mord mathrm mtight">A</span></span></span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span><span class="mpunct mtight">,</span><span class="mspace mtight"><span class="mtight"> </span></span><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight" style="margin-right:0.01389em;">g</span><span class="mord mathrm mtight">a</span><span class="mord mathrm mtight">i</span><span class="mord mathrm mtight">n</span><span class="mord mathrm mtight">s</span></span></span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.2399999999999998em;"><span class="pstrut" style="height:3.01em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.687em;"><span class="pstrut" style="height:3.01em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.42em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05002em;"><span style="top:-2.2500000000000004em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎠</span></span></span><span style="top:-2.8100000000000005em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-4.05002em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55002em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span></span></span></span></span>

<p>where $1/(1+N) = \alpha$ is the smoothing coefficient, which determines how much to weigh the current value and the previous values and is typically chosen to be $N=14$, for the exponential moving average (EMA) which is defined recursively for a series $y_1$, as
$V_i = \alpha V_{i-1} + (1-\alpha)y_i$,
with $V_1 = y_1$, with $V_i$ being the value of the EMA.</p>

<h2 id="macd-moving-average-convergence-divergence">MACD (Moving Average Convergence Divergence)</h2>

<p>The MACD compares the trends over a short (12 periods) and long (26 periods) periods using the exponentially weighted average. The MACD is then the difference between the short and long term trends.
The MACD goes further to calculate the 9 period EMA of the MACD, called the MACD signal and finally compares the two. The being is that when the signal trend crosses the MACD trend there is a momentum shift in the market in the direction dictated by the direction of crossing. The difference between the two then also indicates the strength of this momentum.</p>

<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="normal">M</mi><mi mathvariant="normal">A</mi><mi mathvariant="normal">C</mi><mi mathvariant="normal">D</mi></mrow><mo>=</mo><mi>E</mi><mi>M</mi><mi>A</mi><mo stretchy="false">(</mo><mn>12</mn><mo separator="true">,</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">e</mi></mrow><mo stretchy="false">)</mo><mo>−</mo><mi>E</mi><mi>M</mi><mi>A</mi><mo stretchy="false">(</mo><mn>26</mn><mo separator="true">,</mo><mrow><mi mathvariant="normal">c</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">e</mi></mrow><mo stretchy="false">)</mo><mo separator="true">,</mo><mspace linebreak="newline"></mspace><msub><mrow><mi mathvariant="normal">M</mi><mi mathvariant="normal">A</mi><mi mathvariant="normal">C</mi><mi mathvariant="normal">D</mi></mrow><mrow><mi>s</mi><mi>i</mi><mi>g</mi><mi>n</mi><mi>a</mi><mi>l</mi></mrow></msub><mo>=</mo><mrow><mi mathvariant="normal">E</mi><mi mathvariant="normal">M</mi><mi mathvariant="normal">A</mi></mrow><mo stretchy="false">(</mo><mn>9</mn><mo separator="true">,</mo><mrow><mi mathvariant="normal">M</mi><mi mathvariant="normal">A</mi><mi mathvariant="normal">C</mi><mi mathvariant="normal">D</mi></mrow><mo stretchy="false">)</mo><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">{\rm MACD} = EMA(12, {\rm close})  - EMA(26, {\rm close}), \\
{\rm MACD}_{signal} = {\rm EMA}(9, {\rm MACD}).</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">M</span><span class="mord mathrm">A</span><span class="mord mathrm">C</span><span class="mord mathrm">D</span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">A</span><span class="mopen">(</span><span class="mord">1</span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">c</span><span class="mord mathrm">l</span><span class="mord mathrm">o</span><span class="mord mathrm">s</span><span class="mord mathrm">e</span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">A</span><span class="mopen">(</span><span class="mord">2</span><span class="mord">6</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">c</span><span class="mord mathrm">l</span><span class="mord mathrm">o</span><span class="mord mathrm">s</span><span class="mord mathrm">e</span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathrm">M</span><span class="mord mathrm">A</span><span class="mord mathrm">C</span><span class="mord mathrm">D</span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">E</span><span class="mord mathrm">M</span><span class="mord mathrm">A</span></span></span><span class="mopen">(</span><span class="mord">9</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">M</span><span class="mord mathrm">A</span><span class="mord mathrm">C</span><span class="mord mathrm">D</span></span></span><span class="mclose">)</span><span class="mord">.</span></span></span></span></span>

<h2 id="code">Code</h2>

<p>Below I’ve implemented the above indicators in Python and used them for a number of stocks using the <a href="https://finnhub.io/">Finnhub API</a>.</p>

<p>The python class for dealing with the stocks data:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Stock</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="n">dt</span><span class="p">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="n">dt</span><span class="p">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="n">symbol</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span>
        <span class="k">if</span> <span class="n">end</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">replace</span><span class="p">(</span><span class="n">microsecond</span><span class="o">=</span><span class="mi">0</span><span class="p">).</span><span class="n">timestamp</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">end</span>

        <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># year start
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">dt</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">dt</span><span class="p">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">365</span><span class="p">)).</span><span class="n">timestamp</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>

        <span class="bp">self</span><span class="p">.</span><span class="n">candles</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">_get_candles</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_candles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s">f'https://finnhub.io/api/v1/stock/candle?symbol=</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">symbol</span><span class="si">}</span><span class="s">&amp;resolution=D&amp;from=</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">start</span><span class="si">}</span><span class="s">&amp;to=</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">end</span><span class="si">}</span><span class="s">&amp;token=</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">api_key</span><span class="si">}</span><span class="s">'</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">res</span><span class="p">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">f"Bad request status </span><span class="si">{</span><span class="n">res</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">candles</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">json</span><span class="p">())</span>
        <span class="n">candles</span><span class="p">[</span><span class="s">'t'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">candles</span><span class="p">[</span><span class="s">'t'</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s">'s'</span><span class="p">)</span>
        <span class="n">candles</span> <span class="o">=</span> <span class="n">candles</span><span class="p">.</span><span class="n">set_index</span><span class="p">(</span><span class="s">'t'</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">f"last available date: </span><span class="si">{</span><span class="n">candles</span><span class="p">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="n">date</span><span class="p">()</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">candles</span><span class="p">[[</span><span class="s">'o'</span><span class="p">,</span><span class="s">'c'</span><span class="p">,</span><span class="s">'h'</span><span class="p">,</span><span class="s">'l'</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">RSI</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">candles_rsi</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">candles</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">candles_rsi</span><span class="p">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s">'gain'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">candles_rsi</span><span class="p">[</span><span class="s">'c'</span><span class="p">]</span> <span class="o">-</span> <span class="n">candles_rsi</span><span class="p">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s">'c'</span><span class="p">])</span>
        <span class="n">candles_rsi</span><span class="p">[</span><span class="s">'U'</span><span class="p">]</span> <span class="o">=</span> <span class="n">candles_rsi</span><span class="p">[</span><span class="s">'gain'</span><span class="p">].</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">candles_rsi</span><span class="p">[</span><span class="s">'D'</span><span class="p">]</span> <span class="o">=</span> <span class="n">candles_rsi</span><span class="p">[</span><span class="s">'gain'</span><span class="p">].</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)))</span>
        <span class="n">candles_rsi</span><span class="p">[</span><span class="s">'RS'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">candles_rsi</span><span class="p">[</span><span class="s">'U'</span><span class="p">].</span><span class="n">ewm</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">14</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">14</span><span class="p">).</span><span class="n">mean</span><span class="p">()</span>
                            <span class="o">/</span> <span class="n">candles_rsi</span><span class="p">[</span><span class="s">'D'</span><span class="p">].</span><span class="n">ewm</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">14</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">14</span><span class="p">).</span><span class="n">mean</span><span class="p">())</span>
        <span class="n">candles_rsi</span><span class="p">[</span><span class="s">'RSI'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">-</span> <span class="mi">100</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">candles_rsi</span><span class="p">[</span><span class="s">'RS'</span><span class="p">])</span>

        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">candles_rsi</span><span class="p">[</span><span class="s">'RSI'</span><span class="p">].</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'red'</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'green'</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">f"</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">symbol</span><span class="si">}</span><span class="s">, RSI"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">candles_rsi</span>

    <span class="k">def</span> <span class="nf">bollinger_bands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">periods</span><span class="p">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">std</span><span class="p">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">candles_bol</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">candles</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">sma</span> <span class="o">=</span> <span class="n">candles_bol</span><span class="p">[</span><span class="s">'c'</span><span class="p">].</span><span class="n">rolling</span><span class="p">(</span><span class="n">periods</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="n">periods</span><span class="p">).</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">ema</span> <span class="o">=</span> <span class="n">candles_bol</span><span class="p">[</span><span class="s">'c'</span><span class="p">].</span><span class="n">ewm</span><span class="p">(</span><span class="n">periods</span><span class="p">).</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">candles_bol</span><span class="p">[</span><span class="s">'c'</span><span class="p">].</span><span class="n">rolling</span><span class="p">(</span><span class="n">periods</span><span class="p">).</span><span class="n">std</span><span class="p">()</span>
        <span class="n">upper2</span> <span class="o">=</span> <span class="n">sma</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">sig</span>
        <span class="n">lower2</span> <span class="o">=</span> <span class="n">sma</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">sig</span>

        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">candles_bol</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s">'c'</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'Close price'</span><span class="p">)</span>
        <span class="n">sma</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">'black'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">'--'</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'SMA'</span><span class="p">)</span>
        <span class="n">ema</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">'gray'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">'--'</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'EMA'</span><span class="p">)</span>
        <span class="n">upper2</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">'g'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">'-'</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'Upper band 2'</span><span class="p">)</span>
        <span class="n">lower2</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">'r'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">'-'</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'Lower band 2'</span><span class="p">)</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">lower2</span><span class="p">.</span><span class="n">index</span><span class="p">,</span> <span class="n">lower2</span><span class="p">,</span> <span class="n">upper2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'pink'</span><span class="p">)</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">f"</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">symbol</span><span class="si">}</span><span class="s">, Bollinger Bands"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">MACD</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        Moving Average Convergence Divergence
        """</span>
        <span class="n">candles_macd</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">candles</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">long_ema</span> <span class="o">=</span> <span class="n">candles_macd</span><span class="p">[</span><span class="s">'c'</span><span class="p">].</span><span class="n">ewm</span><span class="p">(</span><span class="mi">26</span><span class="p">).</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">short_ema</span> <span class="o">=</span> <span class="n">candles_macd</span><span class="p">[</span><span class="s">'c'</span><span class="p">].</span><span class="n">ewm</span><span class="p">(</span><span class="mi">12</span><span class="p">).</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">macd</span> <span class="o">=</span> <span class="n">short_ema</span> <span class="o">-</span> <span class="n">long_ema</span>
        <span class="n">macd_signal</span> <span class="o">=</span> <span class="n">macd</span><span class="p">.</span><span class="n">ewm</span><span class="p">(</span><span class="mi">9</span><span class="p">).</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">macd_diff</span> <span class="o">=</span> <span class="n">macd</span> <span class="o">-</span> <span class="n">macd_signal</span>

        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">plot</span><span class="p">(</span><span class="n">candles_macd</span><span class="p">.</span><span class="n">index</span><span class="p">,</span> <span class="n">candles_macd</span><span class="p">[</span><span class="s">'c'</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">'close'</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">plot</span><span class="p">(</span><span class="n">short_ema</span><span class="p">.</span><span class="n">index</span><span class="p">,</span> <span class="n">short_ema</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'12-ema'</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">plot</span><span class="p">(</span><span class="n">long_ema</span><span class="p">.</span><span class="n">index</span><span class="p">,</span> <span class="n">long_ema</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'26-ema'</span><span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">plot</span><span class="p">(</span><span class="n">macd</span><span class="p">.</span><span class="n">index</span><span class="p">,</span> <span class="n">macd</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'MACD'</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">plot</span><span class="p">(</span><span class="n">macd_signal</span><span class="p">.</span><span class="n">index</span><span class="p">,</span> <span class="n">macd_signal</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'MACD signal'</span><span class="p">)</span>
        <span class="n">pos_macd_diff</span> <span class="o">=</span> <span class="n">macd_diff</span><span class="p">[</span><span class="n">macd_diff</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">neg_macd_diff</span> <span class="o">=</span> <span class="n">macd_diff</span><span class="p">[</span><span class="n">macd_diff</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">bar</span><span class="p">(</span><span class="n">pos_macd_diff</span><span class="p">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pos_macd_diff</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'green'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'Positive MACD-MACD_Signal'</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">bar</span><span class="p">(</span><span class="n">neg_macd_diff</span><span class="p">.</span><span class="n">index</span><span class="p">,</span> <span class="n">neg_macd_diff</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'red'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'Negative MACD-MACD_Signal'</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">axhline</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">'gray'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">'--'</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="n">fig</span><span class="p">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s">f"</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">symbol</span><span class="si">}</span><span class="s">, MACD"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">sharpe_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        Calculate sharpe ratio assuming 0 return for risk-free
        """</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">candles</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">df</span><span class="p">[</span><span class="s">'daily_return'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'c'</span><span class="p">].</span><span class="n">pct_change</span><span class="p">()</span>
        <span class="n">df</span><span class="p">[</span><span class="s">'cumulative_return'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'daily_return'</span><span class="p">].</span><span class="n">cumsum</span><span class="p">()</span>
        <span class="n">avg_return</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'daily_return'</span><span class="p">].</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">std_return</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'daily_return'</span><span class="p">].</span><span class="n">std</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">f"Cumulative return: </span><span class="si">{</span><span class="n">df</span><span class="p">[</span><span class="s">'cumulative_return'</span><span class="p">].</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">:.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">%"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">f"Sharpe Ratio: </span><span class="si">{</span><span class="n">avg_return</span><span class="o">/</span><span class="n">std_return</span><span class="p">:.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">, from: </span><span class="si">{</span><span class="n">df</span><span class="p">[</span><span class="s">'daily_return'</span><span class="p">].</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">date</span><span class="p">()</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="n">ax</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df</span><span class="p">.</span><span class="n">cumulative_return</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'cumulative return'</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">.</span><span class="n">legend</span><span class="p">()</span>
</code></pre></div></div>

<p>Examples:</p>

<p>To get the stock closing prices (1 year default):</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tsla</span> <span class="o">=</span> <span class="n">Stock</span><span class="p">(</span><span class="s">'TSLA'</span><span class="p">)</span>
<span class="n">apple</span> <span class="o">=</span> <span class="n">Stock</span><span class="p">(</span><span class="s">'AAPL'</span><span class="p">)</span>
<span class="n">nvidia</span> <span class="o">=</span> <span class="n">Stock</span><span class="p">(</span><span class="s">'NVDA'</span><span class="p">)</span>
<span class="n">amazon</span> <span class="o">=</span> <span class="n">Stock</span><span class="p">(</span><span class="s">'AMZN'</span><span class="p">)</span>
</code></pre></div></div>

<p>To obtain the indicators we use:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tsla</span><span class="p">.</span><span class="n">bollinger_bands</span><span class="p">()</span>
<span class="n">tsla</span><span class="p">.</span><span class="n">RSI</span><span class="p">()</span>
<span class="n">tsla</span><span class="p">.</span><span class="n">MACD</span><span class="p">()</span>
</code></pre></div></div>

<p>Outputs:</p>

<h3 id="tesla">Tesla</h3>

<p><img src="/assets/stocks/bollinger_TSLA.png" alt="tsla1" />
<img src="/assets/stocks/RSI_TSLA.png" alt="tsla2" />
<img src="/assets/stocks/MACD_TSLA.png" alt="tsla3" /></p>

<h3 id="nvidia">Nvidia</h3>

<p><img src="/assets/stocks/bollinger_NVDA.png" alt="nvda1" />
<img src="/assets/stocks/RSI_NVDA.png" alt="nvda2" />
<img src="/assets/stocks/MACD_NVDA.png" alt="nvda3" /></p>

<h3 id="apple">Apple</h3>

<p><img src="/assets/stocks/bollinger_AAPL.png" alt="appl1" />
<img src="/assets/stocks/RSI_AAPL.png" alt="appl2" />
<img src="/assets/stocks/MACD_AAPL.png" alt="appl3" /></p>

<h3 id="amazon">Amazon</h3>

<p><img src="/assets/stocks/bollinger_AMZN.png" alt="amzn1" />
<img src="/assets/stocks/RSI_AMZN.png" alt="amzn2" />
<img src="/assets/stocks/MACD_AMZN.png" alt="amzn3" /></p>

    </div><a class="u-url" href="/2020/10/13/stocks.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>My personal website and blog. Life, Science, Programming and Data Science.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/markd87" title="markd87"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/mmasaniad" title="mmasaniad"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
